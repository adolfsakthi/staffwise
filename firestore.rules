/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a strict authentication-required model for accessing attendance records.
 *
 * Data Structure:
 * All attendance records are stored in the top-level `/attendance_records` collection.
 *
 * Key Security Decisions:
 * - All access to attendance records requires authentication.
 * - Listing attendance records is only permitted for authenticated users.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to individual attendance records.
     * @path /attendance_records/{attendance_record_id}
     * @allow (get) Authenticated users can read any attendance record.
     * @allow (create) Authenticated users can create attendance records.
     * @allow (update) Authenticated users can update attendance records.
     * @allow (delete) Authenticated users can delete attendance records.
     * @deny (get) Unauthenticated users cannot read attendance records.
     * @deny (create) Unauthenticated users cannot create attendance records.
     * @deny (update) Unauthenticated users cannot update attendance records.
     * @deny (delete) Unauthenticated users cannot delete attendance records.
     * @principle Requires authentication for all access to attendance records.
     */
    match /attendance_records/{attendance_record_id} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }
  }

  function isSignedIn() {
    return request.auth != null;
  }
}